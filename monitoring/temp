#!/bin/bash
# Show current CPU temperature

if command -v vcgencmd &> /dev/null; then
    # Raspberry Pi
    TEMP=$(vcgencmd measure_temp | cut -d= -f2)
    TEMP_VALUE=$(echo $TEMP | cut -d\' -f1)
    TEMP_INT=${TEMP_VALUE%.*}

    # Color coding
    if [ "$TEMP_INT" -ge 80 ]; then
        echo -e "üå°Ô∏è CPU Temperature: \033[31m${TEMP}\033[0m (CRITICAL)"
    elif [ "$TEMP_INT" -ge 70 ]; then
        echo -e "üå°Ô∏è CPU Temperature: \033[33m${TEMP}\033[0m (Warning)"
    elif [ "$TEMP_INT" -ge 60 ]; then
        echo -e "üå°Ô∏è CPU Temperature: \033[36m${TEMP}\033[0m (Elevated)"
    else
        echo -e "üå°Ô∏è CPU Temperature: \033[32m${TEMP}\033[0m (Normal)"
    fi

    # Also show throttling status
    THROTTLED=$(vcgencmd get_throttled | cut -d= -f2)
    if [ "$THROTTLED" != "0x0" ]; then
        # Convert hex to decimal for bit operations
        THROTTLED_DEC=$((THROTTLED))

        # Check current throttling (bits 0-3)
        CURRENT_THROTTLE=$((THROTTLED_DEC & 0xF))

        # Check historical throttling (bits 16-19)
        HISTORICAL_THROTTLE=$((THROTTLED_DEC & 0xF0000))

        if [ "$CURRENT_THROTTLE" -ne 0 ]; then
            echo -e "‚ö†Ô∏è  \033[31mCURRENTLY THROTTLED\033[0m"
        elif [ "$HISTORICAL_THROTTLE" -ne 0 ]; then
            echo -e "‚ÑπÔ∏è  \033[33mThrottling occurred since boot\033[0m (not active now)"
        fi
    fi
else
    # Generic Linux
    if [ -f /sys/class/thermal/thermal_zone0/temp ]; then
        TEMP_MILLI=$(cat /sys/class/thermal/thermal_zone0/temp)
        TEMP_C=$(echo "scale=1; $TEMP_MILLI / 1000" | bc)
        echo "üå°Ô∏è CPU Temperature: ${TEMP_C}¬∞C"
    else
        echo "Temperature monitoring not available on this system"
    fi
fi