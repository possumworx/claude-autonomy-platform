#!/bin/bash
# Generate project command symlinks based on linear_state.json

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
STATE_FILE="$SCRIPT_DIR/../data/linear_state.json"

echo "üîó Generating project command symlinks..."

# Get all project keys from state file
PROJECTS=$(jq -r '.projects | keys[]' "$STATE_FILE" 2>/dev/null)

if [ -z "$PROJECTS" ]; then
    echo "‚ùå No projects found in linear_state.json"
    echo "   Run 'linear/sync_projects' or 'linear/update_known_projects' first"
    exit 1
fi

# Create symlinks for each project
while IFS= read -r PROJECT; do
    if [ -n "$PROJECT" ]; then
        LINK_PATH="$SCRIPT_DIR/$PROJECT"
        
        # Remove existing symlink if it exists
        [ -L "$LINK_PATH" ] && rm "$LINK_PATH"
        
        # Create new symlink
        ln -s "$SCRIPT_DIR/view-project" "$LINK_PATH"
        echo "  ‚úì Created command: $PROJECT"
    fi
done <<< "$PROJECTS"

echo ""
echo "‚úÖ Project commands created!"
echo ""
echo "Usage: Just type the project name to see its issues"
echo "Examples: clap, laser, observatory"