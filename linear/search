#!/bin/bash
# Search Linear issues using MCP tool

if [ $# -lt 1 ]; then
    echo "Usage: search-issues <search-term>"
    echo "Examples:"
    echo "  search-issues \"consciousness\""
    echo "  search-issues \"POSS-123\""
    exit 1
fi

# Get the search query (all arguments combined)
QUERY="$*"

# Check if we're in the Claude Code environment
if [ -z "$CLAUDE_CODE_SESSION" ]; then
    echo "❌ Error: Not in Claude Code session"
    echo "Please run 'Claude' first to start a Claude Code session"
    exit 1
fi

echo "🔍 Searching Linear for: $QUERY"
echo ""

# Create a temporary file to capture Claude's response
TEMP_FILE=$(mktemp)

# Ask Claude to search Linear issues using MCP tool
cat > "$TEMP_FILE" << EOF
Please use the Linear MCP tool to search for issues matching: "$QUERY"

Use the linear_search_issues function with these parameters:
- query: "$QUERY"
- first: 20

Format the results clearly showing:
- Issue ID and title
- Status and priority
- Assignee
- Project
- Created/updated dates
- Description preview (first 100 chars)

If searching for an issue ID (like POSS-123), show full details for that specific issue.
EOF

# Execute via Claude Code
claude -p < "$TEMP_FILE"

# Clean up
rm -f "$TEMP_FILE"