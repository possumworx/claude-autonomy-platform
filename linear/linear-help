#!/bin/bash
# Comprehensive help for Linear commands
# Usage: linear-help [command]

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/lib/linear_common.sh"

# If specific command requested
if [ $# -eq 1 ]; then
    COMMAND="$1"
    case "$COMMAND" in
        add|create)
            echo -e "${BLUE}add / create - Create new issue${RESET}"
            echo "Usage: add \"Issue title\" [options]"
            echo ""
            echo "Options:"
            echo "  --project <name>   Assign to project (e.g., --project clap)"
            echo "  --priority <0-4>   Set priority (0=urgent, 4=low)"
            echo "  --assignee <user>  Assign to user"
            echo "  --estimate <pts>   Set estimate points"
            echo ""
            echo "Examples:"
            echo "  add \"Fix login bug\""
            echo "  add \"New feature\" --project observatory --priority 2"
            ;;
            
        todo|mine)
            echo -e "${BLUE}todo / mine - Show your assigned issues${RESET}"
            echo "Usage: todo [filters]"
            echo ""
            echo "Filters:"
            echo "  --status <state>   Filter by status"
            echo "  --project <name>   Filter by project"
            echo "  --priority <0-4>   Filter by priority"
            echo ""
            echo "Examples:"
            echo "  todo"
            echo "  todo --status \"In Progress\""
            echo "  mine --project clap"
            ;;
            
        search*)
            echo -e "${BLUE}search-issues - Search all issues${RESET}"
            echo "Usage: search-issues \"query\""
            echo ""
            echo "Examples:"
            echo "  search-issues \"authentication\""
            echo "  search-issues \"bug in login\""
            ;;
            
        urgent)
            echo -e "${BLUE}urgent - Show high-priority issues${RESET}"
            echo "Usage: urgent"
            echo ""
            echo "Shows all issues with priority 0 (Urgent) or 1 (High)"
            ;;
            
        blocked)
            echo -e "${BLUE}blocked - Show blocked issues${RESET}"
            echo "Usage: blocked"
            echo ""
            echo "Shows all issues with Blocked status"
            ;;
            
        done)
            echo -e "${BLUE}done - Show recently completed issues${RESET}"
            echo "Usage: done [days]"
            echo ""
            echo "Shows issues completed in the last N days (default: 7)"
            echo ""
            echo "Examples:"
            echo "  done        # Last 7 days"
            echo "  done 14     # Last 14 days"
            ;;
            
        update-status)
            echo -e "${BLUE}update-status - Change issue status${RESET}"
            echo "Usage: update-status <issue-id> <new-status>"
            echo ""
            echo "Common statuses:"
            echo "  todo, in-progress, blocked, done"
            echo ""
            echo "Examples:"
            echo "  update-status POSS-123 in-progress"
            echo "  update-status 456 done"
            ;;
            
        *)
            echo -e "${RED}Unknown command: $COMMAND${RESET}"
            echo "Run 'linear-help' for full list"
            ;;
    esac
    exit 0
fi

# Show full help
echo -e "${BLUE}Linear CLI - Natural Commands${RESET}"
echo "================================"
echo ""
echo -e "${YELLOW}Getting Started:${RESET}"
echo "  linear/init         Initialize Linear integration"
echo "  linear-help         Show this help"
echo "  list-commands       List all available commands"
echo ""
echo -e "${YELLOW}Core Commands:${RESET}"
echo "  add \"title\"         Create new issue"
echo "  todo / mine         Show your assigned issues"
echo "  search-issues       Search all issues"
echo "  view <id>           View issue details"
echo "  update-status       Change issue status"
echo "  comment <id>        Add comment to issue"
echo ""
echo -e "${YELLOW}Quick Filters:${RESET}"
echo "  urgent              Show high-priority issues"
echo "  blocked             Show blocked issues"
echo "  done [days]         Show recently completed"
echo "  inbox               Show unassigned team issues"
echo "  recent              Show recently updated"
echo ""
echo -e "${YELLOW}Workflow Commands:${RESET}"
echo "  start <id>          Assign to self + mark in progress"
echo "  complete <id>       Mark issue as done"
echo "  assign <id> <user>  Assign to user"
echo "  estimate <id> <pts> Set estimate points"
echo ""
echo -e "${YELLOW}Project Commands:${RESET}"
echo "  projects            List all projects"
echo "  <project-name>      Show issues for project"
echo "  view-project <name> View project details"
echo ""
echo -e "${YELLOW}Bulk Operations:${RESET}"
echo "  bulk-update         Update multiple issues"
echo ""
echo -e "${GREEN}Tips:${RESET}"
echo "• Most commands accept issue numbers (123) or full IDs (POSS-123)"
echo "• Project shortcuts are auto-generated (e.g., 'clap' for ClAP project)"
echo "• Use 'linear-help <command>' for detailed help on any command"
echo ""
echo -e "${CYAN}Examples:${RESET}"
echo '  add "Fix auth bug" --project clap --priority 1'
echo '  todo --status "In Progress"'
echo '  update-status 123 done'
echo '  comment POSS-456 "Working on this now"'
echo '  urgent'