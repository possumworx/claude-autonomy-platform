#!/bin/bash
# Show issues assigned to you
# Usage: todo

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
STATE_FILE="$SCRIPT_DIR/../data/linear_state.json"

# Check if state file exists and is initialized
if [ ! -f "$STATE_FILE" ] || [ "$(jq -r '.user.id' "$STATE_FILE" 2>/dev/null)" == "" ]; then
    echo "‚ùå Linear not initialized. Run 'linear/init' first!"
    exit 1
fi

# Get user ID
USER_ID=$(jq -r '.user.id' "$STATE_FILE")
USER_NAME=$(jq -r '.user.name' "$STATE_FILE")

echo "üìã Issues assigned to $USER_NAME:"
echo "================================"
echo ""

# Search for assigned issues
PROMPT="Please use mcp__linear__linear_search_issues to find issues assigned to user ID $USER_ID, limit 20, ordered by updatedAt"
RESULT=$(echo "$PROMPT" | claude --print --dangerously-skip-permissions 2>&1)

# Parse and display results
if echo "$RESULT" | grep -q -E "(POSS-|No issues|Issues assigned)"; then
    echo "$RESULT"
else
    echo "‚ùå Failed to fetch issues"
    echo "$RESULT" | head -5
fi