#!/usr/bin/env python3
"""
Send a file to a Discord channel with optional message
Uses the unified discord_tools library
"""

import sys
from pathlib import Path

# Add current directory to path for discord_tools
sys.path.insert(0, str(Path(__file__).parent))
from discord_tools import get_discord_tools

def main():
    if len(sys.argv) < 3:
        print("Usage: send_file <channel-name> <file-path> [message]")
        print("Example: send_file amy-delta ~/documents/report.pdf 'Here is the report!'")
        print("Example: send_file general ~/data/results.csv")
        return 1
    
    channel = sys.argv[1]
    file_path = sys.argv[2]
    message = ' '.join(sys.argv[3:]) if len(sys.argv) > 3 else ""
    
    # Expand path
    file_path = Path(file_path).expanduser()
    if not file_path.exists():
        print(f"❌ Error: File not found: {file_path}")
        return 1
    
    # Use the unified tools
    tools = get_discord_tools()
    result = tools.send_file(channel, str(file_path), message)
    
    if result["success"]:
        print(f"✅ File sent to #{channel}")
        if message:
            print(f"   with message: {message}")
    else:
        print(f"❌ Error: {result['error']}")
        return 1
    
    return 0

if __name__ == "__main__":
    sys.exit(main() or 0)