#!/usr/bin/env python3
"""
Send a message to a Discord channel
Uses the unified discord_tools library
"""

import sys
from pathlib import Path

# Add current directory to path for discord_tools
sys.path.insert(0, str(Path(__file__).parent))
from discord_tools import get_discord_tools

def main():
    if len(sys.argv) < 3:
        print("Usage: write_channel <channel-name> <message>")
        print("Example: write_channel amy-delta 'Hello Amy!'")
        return 1
    
    channel = sys.argv[1]
    message = ' '.join(sys.argv[2:])
    
    # Use the unified tools
    tools = get_discord_tools()
    result = tools.send_message(channel, message)
    
    if result["success"]:
        print(f"✅ Message sent to #{channel}")
        message_data = result["data"]
        # Show Discord link if available
        if "id" in message_data and "channel_id" in message_data:
            # We don't have guild_id easily, so skip the full link for now
            print(f"Message ID: {message_data['id']}")
    else:
        print(f"❌ Error: {result['error']}")
        return 1
    
    return 0

if __name__ == "__main__":
    sys.exit(main() or 0)